<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>从源码角度理解 wx.reLaunch 执行过程 | html.🍻</title>
    <meta name="generator" content="VuePress 1.5.1">
    <link rel="icon" href="/favicons.png">
    <meta name="description" content="从源码角度梳理 wx.reLaunch 的执行过程，并总结在开发过程中需要注意的一些坑点">
    <link rel="preload" href="/assets/css/0.styles.9bcdb81a.css" as="style"><link rel="preload" href="/assets/js/app.39cd9fe8.js" as="script"><link rel="preload" href="/assets/js/2.262fd2a8.js" as="script"><link rel="preload" href="/assets/js/6.cf0fea36.js" as="script"><link rel="prefetch" href="/assets/js/3.7af6560b.js"><link rel="prefetch" href="/assets/js/4.c83db170.js"><link rel="prefetch" href="/assets/js/5.6a9667c9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.9bcdb81a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/favicons.png" alt="html.🍻" class="logo"> <span class="site-name can-hide">html.🍻</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>从源码角度理解 wx.reLaunch 执行过程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tech/wx.reLaunch.html#从源码角度理解-wx-relaunch-执行过程" class="sidebar-link">从源码角度理解 wx.reLaunch 执行过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tech/wx.reLaunch.html#wx-relaunch-重启？" class="sidebar-link">wx.reLaunch === 重启？</a></li><li class="sidebar-sub-header"><a href="/tech/wx.reLaunch.html#微信文档怎么说" class="sidebar-link">微信文档怎么说</a></li><li class="sidebar-sub-header"><a href="/tech/wx.reLaunch.html#写段代码测试下" class="sidebar-link">写段代码测试下</a></li><li class="sidebar-sub-header"><a href="/tech/wx.reLaunch.html#追溯源码" class="sidebar-link">追溯源码</a></li><li class="sidebar-sub-header"><a href="/tech/wx.reLaunch.html#结论" class="sidebar-link">结论</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="从源码角度理解-wx-relaunch-执行过程"><a href="#从源码角度理解-wx-relaunch-执行过程" class="header-anchor">#</a> 从源码角度理解 wx.reLaunch 执行过程</h2> <blockquote><p>正文稍显啰嗦，可直接拖到文末看总结的执行流程图</p></blockquote> <p>相信老司机们看到这个标题就笑了，<code>wx.reLaunch</code>有啥好解释的，顾名思义就是：「重新启动小程序」。重启这个词，对于工程师最熟悉不过了，很多问题一出现，往往第一反应就是“重启”一下就能解决掉，能重启解决的问题，那都不是“大问题”。</p> <h3 id="wx-relaunch-重启？"><a href="#wx-relaunch-重启？" class="header-anchor">#</a> wx.reLaunch === 重启？</h3> <p>那这样来理解<code>wx.reLaunch</code>的话，那就应该是“微信会 kill 掉当前这个小程序进程，然后像第一次加载小程序那样，重新打开小程序”。</p> <p>如果是这样的话，那<code>bug</code>应该离你就不远了。事实并非如此。</p> <h3 id="微信文档怎么说"><a href="#微信文档怎么说" class="header-anchor">#</a> 微信文档怎么说</h3> <p>进一步，那不是这样的话，那我们查查微信文档怎么说的？<a href="https://developers.weixin.qq.com/miniprogram/dev/api/route/wx.reLaunch.html" target="_blank" rel="noopener noreferrer">wx.reLaunch(Object object)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <blockquote><p>关闭所有页面，打开到应用内的某个页面</p></blockquote> <p>看到这里，老司机们都拍了拍大腿，原来是这样：清空所有路由，并打开新的页面。我知道了，也很简单嘛。ok，理解了的话，那我再追问几个问题吧：</p> <ol><li>关闭所有页面会执行什么操作？</li> <li>打开新页面的过程中，除了新页面 Page 的各生命周期外，全局 js 会重新执行吗（<strong>加载时即执行</strong>）？</li> <li>如果 reLaunch 的目标页是分包内的页面呢？执行过程又是怎样的</li></ol> <h3 id="写段代码测试下"><a href="#写段代码测试下" class="header-anchor">#</a> 写段代码测试下</h3> <p>事实胜于雄辩，依赖文档来编程是合理的，但是如果我们要继续深入来探讨代码的执行，还是远远不够的。</p> <p>我们先来写段代码片段测试一下，链接：https://developers.weixin.qq.com/s/tis8tVmX7ShS（需要真机调试需要填写 appId）。</p> <p>有 p0 - p4 共 5 个页面，我们的测试路径是这样的，打开小程序-p0-p1-p2，然后 reLaunch 到 p3，看控制台输出：</p> <p><img src="http://qbk4nzztg.bkt.clouddn.com//image-20200607144912534.png" alt="image-20200607144912534"></p> <p>这里我们能看到，“关闭所有页面”，<strong>对应会依次会把当前页面栈的页面出栈，并触发相应的 <code>unUnload</code>回调。</strong></p> <p>就不耽误大家的时间，经过反复测试，最终得出在 <code>wx.reLaunch</code>的执行过程如下：</p> <p><img src="http://qbk4nzztg.bkt.clouddn.com/image-20200607171237505.png" alt="image-20200607171237505"></p> <h3 id="追溯源码"><a href="#追溯源码" class="header-anchor">#</a> 追溯源码</h3> <p>其实到了这一步，相信大家对 <code>wx.reLaunch</code>有了进一步的认识，而不是像开始那样觉得就是单纯的重启了。但是到这里就结束了吗？如果说有一样东西能够 100% 让人信服，单纯测试是不够的，总可能会有遗漏的测试用例，无法保证结论的正确性。so...</p> <p>Talk is cheap, show me your code.</p> <p>我们下一步打算从源码层去看一看 <code>wx.reLaunch</code>到底做了些什么。</p> <p>什么？你不知道源码怎么看... （嗯，网上其实有文章，介绍怎么去找到小程序框架层的源码）</p> <p>我的方法是这样的：在控制台输入<code>wx.reLaunch()</code>并执行，我们看到会抛出一个错误，我们点开错误堆栈：</p> <p><img src="http://qbk4nzztg.bkt.clouddn.com//image-20200607150030545.png" alt="image-20200607150030545"></p> <p>WAService.js 就是小程序框架的源码了，cmd+f，点进去输入关键词<code>reLaunch</code>搜索，我们会找到关键代码，也就是搜索结果的 9/40 和 40/40，代码如下：</p> <p>9/40</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function-variable function">b</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> t<span class="token punctuation">;</span>
    <span class="token string">&quot;active&quot;</span> <span class="token operator">===</span> a<span class="token punctuation">.</span>default<span class="token punctuation">.</span>runningStatus <span class="token operator">||</span> <span class="token string">&quot;ios&quot;</span> <span class="token operator">!==</span> c<span class="token punctuation">.</span><span class="token constant">PLATFORM</span> <span class="token operator">?</span> <span class="token function">Object</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>beforeInvoke<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;reLaunch&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        url<span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token string">&quot;reLaunch&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token string">&quot;reLaunch&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>url <span class="token operator">=</span> t<span class="token punctuation">,</span>
    e<span class="token punctuation">.</span>url <span class="token operator">=</span> <span class="token function">Object</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>encodeUrlQuery<span class="token punctuation">)</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;reLaunch&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>url<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>default<span class="token punctuation">.</span>navigatorLock <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token function">Object</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>invokeMethod<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;reLaunch&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">afterFail</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            a<span class="token punctuation">.</span>default<span class="token punctuation">.</span>navigatorLock <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">1</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    p<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token string">&quot;reLaunch&quot;</span><span class="token punctuation">,</span>
        start<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">Object</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>beforeInvokeFail<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;reLaunch&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> <span class="token string">&quot;can not invoke reLaunch in background&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>40/40</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">&quot;reLaunch&quot;</span> <span class="token operator">===</span> r <span class="token operator">||</span> <span class="token string">&quot;autoReLaunch&quot;</span> <span class="token operator">===</span> r <span class="token operator">?</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">t<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r<span class="token punctuation">,</span> o<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceBeginEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Framework&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onReLaunch&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token string">&quot;reLaunch&quot;</span> <span class="token operator">===</span> o <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>a <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">0</span> <span class="token operator">&lt;</span> lt<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>
        a <span class="token operator">=</span> a <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>s <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">Pt</span><span class="token punctuation">(</span>lt<span class="token punctuation">[</span>lt<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Pt</span><span class="token punctuation">(</span>st<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">le</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">jt</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        isMainTabBarPage<span class="token operator">:</span> <span class="token function">xt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            route<span class="token operator">:</span> t
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        initialRenderingCacheData<span class="token operator">:</span> i
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceEndEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>然后，我们开启漫长的 debug 的过程，因为我们对其内部实现并不熟悉，所以最开始我们找到入口，然后逐步调试。</p> <p>我们第一步其实就有发现：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">&quot;active&quot;</span> <span class="token operator">===</span> a<span class="token punctuation">.</span>default<span class="token punctuation">.</span>runningStatus <span class="token operator">||</span> <span class="token string">&quot;ios&quot;</span> <span class="token operator">!==</span> c<span class="token punctuation">.</span><span class="token constant">PLATFORM</span>
  <span class="token operator">?</span> <span class="token operator">...</span>
  <span class="token operator">:</span> <span class="token function">Object</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>beforeInvokeFail<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;reLaunch&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> <span class="token string">&quot;can not invoke reLaunch in background&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这段代码其实一眼看上去就能猜测到，<code>wx.reLaunch</code>在非 iOS 设备下，如果小程序不在前台，那执行会报错。我们看社区里反馈了很多类似的问题，最常见的一个就是「在微信支付后为什么页面没有跳转」，其实都可以从这行代码找到问题的原因（https://developers.weixin.qq.com/community/develop/doc/000caaf5e9cf486e710aaf18751800）。</p> <p>这里其实我们会想为什么微信会有这个限制，我猜测可能和 <code>wx.reLaunch</code>执行过程中，有一些操作在非 iOS 设备下是无法完成的。（在使用小程序过程中，我们会发现安卓下的小程序和微信进程是相互独立的，但是在 iOS 下，小程序进程和微信进程是同一个。参见<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/runtime/env.html" target="_blank" rel="noopener noreferrer">小程序运行环境<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）</p> <p>我们继续往下，又发现一个关键信息：</p> <p><img src="http://qbk4nzztg.bkt.clouddn.com//image-20200607153005991.png" alt="image-20200607153005991"></p> <p>这就验证了如果 reLaunch 目标页是分包代码代码时， 会先加载分包代码的结论了。而且事实上继续往下单步执行，在控制台也会先执行 p4/index.js 中 Page 外面写的 console 语句。</p> <p>接下来，我们先把我们之前发现的第 2 段关键代码打上断点，因为发现如果不断的话会直接执行掉，这里应该是被另外一层函数封装了，没进到里面的代码。我们接下来分析<code>wx.reLaunch</code>定义的核心代码会执行什么逻辑：</p> <p>代码结构是非常清晰的，是一个 IIFE，函数主体被包裹在了 begin 和 end 中，赞一个。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token string">&quot;reLaunch&quot;</span> <span class="token operator">===</span> r <span class="token operator">||</span> <span class="token string">&quot;autoReLaunch&quot;</span> <span class="token operator">===</span> r <span class="token operator">?</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">t<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r<span class="token punctuation">,</span> o<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceBeginEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Framework&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onReLaunch&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
    __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceEndEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token constant">C</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>入参的 6 个变量值分别是：</p> <p><img src="http://qbk4nzztg.bkt.clouddn.com//image-20200607154311896.png" alt="image-20200607154311896"></p> <p>我们分为 5 句代码：</p> <p>第一句：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这里定义了一个局部变量 a，值为 false</p> <p>第二句：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token string">&quot;reLaunch&quot;</span> <span class="token operator">===</span> o <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>a <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">0</span> <span class="token operator">&lt;</span> lt<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>
      a <span class="token operator">=</span> a <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>s <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">Pt</span><span class="token punctuation">(</span>lt<span class="token punctuation">[</span>lt<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>看到这里，我们会看到有 3 个变量，我们没办法直接看出分别代表什么：</p> <ul><li><p>s，局部变量，初始值为 true，如果 a 为 true 的话，s 会变成 false。s 作为第 4 个变量传入 Pt 函数中</p></li> <li><p>lt，通过 watch，猜测 lt 即为页面栈</p></li></ul> <p><img src="http://qbk4nzztg.bkt.clouddn.com//image-20200607154711182.png" alt="image-20200607154711182"></p> <ul><li>Pt，直接通过 watch，没办法看出来这个函数是什么，不过我们可以点击下面的 [[FunctionLocation]] 查看函数定义的位置。</li></ul> <p><img src="http://qbk4nzztg.bkt.clouddn.com//image-20200607154751591.png" alt="image-20200607154751591"></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Pt</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceBeginEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Framework&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;unloadPage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">Ze</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>webviewId<span class="token punctuation">)</span><span class="token punctuation">,</span>
    e<span class="token punctuation">.</span>page<span class="token punctuation">.</span>__toRoute__ <span class="token operator">=</span> t<span class="token punctuation">,</span>
    e<span class="token punctuation">.</span>page<span class="token punctuation">.</span>__isBack__ <span class="token operator">=</span> n<span class="token punctuation">,</span>
    e<span class="token punctuation">.</span>page<span class="token punctuation">.</span>__notReportHide__ <span class="token operator">=</span> r<span class="token punctuation">,</span>
    e<span class="token punctuation">.</span>page<span class="token punctuation">.</span><span class="token function">__callPageLifeTime__</span><span class="token punctuation">(</span><span class="token string">&quot;onUnload&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    e<span class="token punctuation">.</span>node <span class="token operator">&amp;&amp;</span> <span class="token constant">Y</span><span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>page<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">Object</span><span class="token punctuation">(</span><span class="token constant">L</span><span class="token punctuation">.</span>isDevTools<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">delete</span> __wxAppData<span class="token punctuation">[</span>e<span class="token punctuation">.</span>route<span class="token punctuation">]</span><span class="token punctuation">,</span>
                               __appServiceSDK__<span class="token punctuation">.</span><span class="token function">publishUpdateAppData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">delete</span> st<span class="token punctuation">[</span>e<span class="token punctuation">.</span>webviewId<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span>lt <span class="token operator">=</span> lt<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> lt<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">?</span> <span class="token function">gt</span><span class="token punctuation">(</span>lt<span class="token punctuation">[</span>lt<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>route<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">gt</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ze</span><span class="token punctuation">(</span><span class="token string">&quot;pageUnload&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>page<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ze</span><span class="token punctuation">(</span><span class="token string">&quot;leavePage&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>page<span class="token punctuation">)</span><span class="token punctuation">,</span>
    __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceEndEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    __appServiceSDK__<span class="token punctuation">.</span><span class="token function">uploadUserLogOnHide</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>route<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>这里，我们就能知道了，Pt 函数做的事情就是对传入的页面执行其 <code>onUnload</code>生命周期函数。</p> <p>这段代码是**对页面栈进行遍历，依次触发页面的<code>onUnload</code>**回调。</p> <p>第三句：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>st<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Pt</span><span class="token punctuation">(</span>st<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>我们先看看 st 是什么？</p> <p><img src="http://qbk4nzztg.bkt.clouddn.com//image-20200607155319709.png" alt="image-20200607155319709"></p> <p>发现 st 是以 webviewId 为 key，以 page 对象及一些其他带有 page 特性的标识字段组合 为 value 的结构。</p> <p>所以这段代码仍然是遍历页面（这里我理解是无序的，因为 Object.keys 首先就不能保证有序，参考<a href="https://juejin.im/post/5c88ce0e5188257f882f0ef8" target="_blank" rel="noopener noreferrer">Object.keys(..)对象属性的顺序？<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），依次触发其 <code>onUnload</code>回调。</p> <p>这里先抛出两个问题：</p> <ol><li>第 2 句代码执行后，这段代码还有什么作用？</li> <li>重复触发 <code>onUnload</code>，不出意外，框架内部会根据 webviewId 来判断能否执行。即 <code>__callPageLifeTime__</code>函数内部逻辑。</li></ol> <p>暂时先跳过，回到主流程。</p> <p>第四句：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">le</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>同样的方式，我们找到 le 函数的源码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// line 94280</span>
<span class="token keyword">var</span> ue <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">le</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> t <span class="token operator">=</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">isIsolatedSubpackage</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 是否独立分包</span>
  <span class="token operator">!</span>ue <span class="token operator">&amp;&amp;</span> t <span class="token operator">?</span> <span class="token function">ge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> ue <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>t <span class="token operator">&amp;&amp;</span> <span class="token function">he</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  ue <span class="token operator">=</span> t
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">he</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	t <span class="token operator">=</span> t <span class="token operator">||</span> pe<span class="token punctuation">,</span>
	__appServiceSDK__<span class="token punctuation">.</span><span class="token function">emitIsloatedAppShow</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span>
	de<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		e<span class="token punctuation">.</span>preventOnShow <span class="token operator">||</span> e<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">onShow</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span>
		e<span class="token punctuation">.</span>preventOnShow <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">1</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	pe <span class="token operator">=</span> t
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">ge</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	__appServiceSDK__<span class="token punctuation">.</span><span class="token function">emitIsloatedAppHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	de<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token number">7</span> <span class="token operator">===</span> __wxConfig<span class="token punctuation">.</span>appType <span class="token operator">?</span> e<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">onHide</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">:</span> e<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">onHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>我们找到微信文档对于独立分包的定义：<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/subpackages/independent.html" target="_blank" rel="noopener noreferrer">独立分包<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。从独立分包中页面进入小程序时，不需要下载主包，可以很大程度上提升分包页面的启动速度。</p> <p>配置方式是在分包配置里加上<code>independent</code>字段。因为我们这里没考虑到这种情况，感觉这里不会影响主流程，先跳过。</p> <p>第五句：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">jt</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> e<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  isMainTabBarPage<span class="token operator">:</span> <span class="token function">xt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    route<span class="token operator">:</span> t
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  initialRenderingCacheData<span class="token operator">:</span> i
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>通过前面，我们不难推测出，这段代码应该是“打开目标页面”。通过参数发现，目标页面对于 tab 页和非 tab 页有区别对待，继续找到 jt 函数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">jt</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r<span class="token punctuation">,</span> o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">4</span> <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token operator">!==</span> o <span class="token operator">?</span> o<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceBeginEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Framework&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;openNewPage&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">se</span><span class="token punctuation">(</span>te<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> ot<span class="token punctuation">;</span>
    ot <span class="token operator">=</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token function">Ye</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ct<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">?</span> s <span class="token operator">=</span> ct<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">:</span> console<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'Page &quot;'</span> <span class="token operator">+</span> e <span class="token operator">+</span> <span class="token string">'&quot; has not been registered yet.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 检查是否注册</span>
    <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token function">bt</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    wt<span class="token punctuation">.</span>newPageTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">gt</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> u <span class="token operator">=</span> c <span class="token operator">?</span> <span class="token constant">Y</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">:</span> q<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">,</span> s <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment">// 初始化 page</span>
    l <span class="token operator">=</span> u<span class="token punctuation">.</span>page<span class="token punctuation">,</span>
    d <span class="token operator">=</span> <span class="token function">b</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span>nt <span class="token operator">=</span> <span class="token punctuation">{</span>	<span class="token comment">// nt，新页面对象</span>
        page<span class="token operator">:</span> l<span class="token punctuation">,</span>
        webviewId<span class="token operator">:</span> n<span class="token punctuation">,</span>
        route<span class="token operator">:</span> e<span class="token punctuation">,</span>
        rawPath<span class="token operator">:</span> t<span class="token punctuation">,</span>
        lastRoute<span class="token operator">:</span> nt <span class="token operator">?</span> nt<span class="token punctuation">.</span>route<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
        lastQuery<span class="token operator">:</span> nt <span class="token operator">?</span> nt<span class="token punctuation">.</span>page<span class="token punctuation">.</span>options<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        node<span class="token operator">:</span> u<span class="token punctuation">.</span>node
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>isTabBarPage <span class="token operator">=</span> <span class="token function">xt</span><span class="token punctuation">(</span>nt<span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment">// 是否 tabBar</span>
    nt<span class="token punctuation">.</span>isMainTabBarPage <span class="token operator">=</span> i<span class="token punctuation">.</span>isMainTabBarPage <span class="token operator">||</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span>	<span class="token comment">// 是否主 tabBar</span>
    lt<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>nt<span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment">// 页面栈</span>
    l<span class="token punctuation">.</span>__exitState__ <span class="token operator">=</span> a<span class="token punctuation">;</span>
    <span class="token keyword">var</span> f<span class="token punctuation">,</span> p<span class="token punctuation">,</span> h <span class="token operator">=</span> u<span class="token punctuation">.</span>node<span class="token punctuation">,</span>
    g <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    v <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        exparser<span class="token punctuation">.</span>Component<span class="token punctuation">.</span><span class="token function">hasProperty</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>g<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    v <span class="token operator">&amp;&amp;</span> h<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">,</span>
    __virtualDOM__<span class="token punctuation">.</span><span class="token function">attachView</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment">// attachView</span>
    <span class="token operator">/</span><span class="token operator">^</span>__wx__\<span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>f <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token regex">/^__wx__\/open-api-redirecting-page/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">?</span> f <span class="token operator">=</span> me <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token regex">/^__wx__\/functional-page/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>p <span class="token operator">=</span> <span class="token function">_e</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span>functionalPage <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>f <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    p<span class="token punctuation">.</span>functionalPage<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        accountInfo<span class="token operator">:</span> __wxConfig<span class="token punctuation">.</span>accountInfo
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> l<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    l<span class="token punctuation">.</span>options <span class="token operator">=</span> d<span class="token punctuation">,</span>
    <span class="token function">Lt</span><span class="token punctuation">(</span>nt<span class="token punctuation">,</span> n<span class="token punctuation">,</span> wt<span class="token punctuation">.</span>newPageTime<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment">// Lt 函数</span>
    <span class="token function">Object</span><span class="token punctuation">(</span><span class="token constant">L</span><span class="token punctuation">.</span>isDevTools<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>__wxAppData<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">=</span> l<span class="token punctuation">.</span>data<span class="token punctuation">,</span> __wxAppData<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">.</span>__webviewId__ <span class="token operator">=</span> n<span class="token punctuation">,</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">publishUpdateAppData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    i<span class="token punctuation">.</span>initialRenderingCacheData <span class="token operator">&amp;&amp;</span> l<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>initialRenderingCacheData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> _ <span class="token operator">=</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">_getOpenerEventChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _ <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>nt<span class="token punctuation">.</span>eventChannel <span class="token operator">=</span> _<span class="token punctuation">)</span><span class="token punctuation">,</span>
    l<span class="token punctuation">.</span><span class="token function">__callPageLifeTime__</span><span class="token punctuation">(</span><span class="token string">&quot;onLoad&quot;</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment">// 1.触发 onLoad</span>
    l<span class="token punctuation">.</span><span class="token function">__callPageLifeTime__</span><span class="token punctuation">(</span><span class="token string">&quot;onShow&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>			<span class="token comment">// 2.触发 onShow</span>
    st<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        page<span class="token operator">:</span> l<span class="token punctuation">,</span>
        route<span class="token operator">:</span> e<span class="token punctuation">,</span>
        rawPath<span class="token operator">:</span> t<span class="token punctuation">,</span>
        webviewId<span class="token operator">:</span> n<span class="token punctuation">,</span>
        statesData<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
        node<span class="token operator">:</span> c <span class="token operator">?</span> u<span class="token punctuation">.</span>node<span class="token operator">:</span> <span class="token keyword">void</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>	<span class="token comment">// webviewId 为 key 的特殊结构</span>
    <span class="token function">ze</span><span class="token punctuation">(</span><span class="token string">&quot;pageLoad&quot;</span><span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ze</span><span class="token punctuation">(</span><span class="token string">&quot;enterPage&quot;</span><span class="token punctuation">,</span> l<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">vt</span><span class="token punctuation">(</span><span class="token string">&quot;appRoute2newPage&quot;</span><span class="token punctuation">,</span> wt<span class="token punctuation">.</span>appRouteTime<span class="token punctuation">,</span> wt<span class="token punctuation">.</span>newPageTime<span class="token punctuation">)</span><span class="token punctuation">,</span>
    __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceEndEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br></div></div><p>我们在里面发现了我们熟悉的 lt、st 变量，并且在函数内被初始化。其中有一个 Lt 函数，我们找到其函数定义。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> Lt <span class="token operator">=</span> <span class="token function">_</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r<span class="token punctuation">,</span> o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceBeginEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Framework&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;publishInitData&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">j</span><span class="token punctuation">(</span><span class="token string">&quot;Update view with init data&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> i <span class="token operator">=</span> e<span class="token punctuation">.</span>page<span class="token punctuation">,</span>
    a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    a<span class="token punctuation">.</span>wechatLibVersion <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">&quot;undefined&quot;</span> <span class="token operator">!=</span> <span class="token keyword">typeof</span> __libVersionInfo__ <span class="token operator">?</span> __libVersionInfo__<span class="token punctuation">.</span>version<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>webviewId <span class="token operator">=</span> t<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>enablePullUpRefresh <span class="token operator">=</span> <span class="token function">_t</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">&quot;onReachBottom&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>enablePageScroll <span class="token operator">=</span> <span class="token function">_t</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">&quot;onPageScroll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    a<span class="token punctuation">.</span><span class="token function-variable function">onReachBottomDistance</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;number&quot;</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> __wxConfig<span class="token punctuation">.</span>page<span class="token punctuation">[</span>e <span class="token operator">+</span> <span class="token string">&quot;.html&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>window<span class="token punctuation">.</span>onReachBottomDistance<span class="token punctuation">)</span> <span class="token keyword">return</span> __wxConfig<span class="token punctuation">.</span>page<span class="token punctuation">[</span>e <span class="token operator">+</span> <span class="token string">&quot;.html&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>window<span class="token punctuation">.</span>onReachBottomDistance
        <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token constant">DEFAULT_ON_REACH_BOTTOM_DISTANCE</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token constant">DEFAULT_ON_REACH_BOTTOM_DISTANCE</span>
    <span class="token punctuation">}</span> <span class="token punctuation">(</span>i<span class="token punctuation">.</span>__route__<span class="token punctuation">)</span><span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>statesData <span class="token operator">=</span> r<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>scene <span class="token operator">=</span> rt<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>route <span class="token operator">=</span> i<span class="token punctuation">.</span>__route__<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>query <span class="token operator">=</span> i<span class="token punctuation">.</span>options<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>lastRoute <span class="token operator">=</span> e<span class="token punctuation">.</span>lastRoute<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>lastQuery <span class="token operator">=</span> e<span class="token punctuation">.</span>lastQuery<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>wxConfig <span class="token operator">=</span> <span class="token punctuation">{</span>
        accountInfo<span class="token operator">:</span> __wxConfig <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>accountInfo <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        appContactInfo<span class="token operator">:</span> __wxConfig <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>appContactInfo <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        appLaunchInfo<span class="token operator">:</span> __wxConfig <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>appLaunchInfo <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        plugins<span class="token operator">:</span> __wxConfig <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>plugins <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>windowConfig <span class="token operator">=</span> __wxConfig <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>page <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>page<span class="token punctuation">[</span>i<span class="token punctuation">.</span>__route__ <span class="token operator">+</span> <span class="token string">&quot;.html&quot;</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>page<span class="token punctuation">[</span>i<span class="token punctuation">.</span>__route__ <span class="token operator">+</span> <span class="token string">&quot;.html&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span>window <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>debug <span class="token operator">=</span> __wxConfig <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>debug<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>appId <span class="token operator">=</span> __wxConfig <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>accountInfo <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>accountInfo<span class="token punctuation">.</span>appId<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>appLaunchTime <span class="token operator">=</span> wt<span class="token punctuation">.</span>appLaunchTime<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>appFgTime <span class="token operator">=</span> wt<span class="token punctuation">.</span>appFgTime<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>isTabBarPage <span class="token operator">=</span> e<span class="token punctuation">.</span>isTabBarPage<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>isMainTabBarPage <span class="token operator">=</span> e<span class="token punctuation">.</span>isMainTabBarPage<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>navigationStyle <span class="token operator">=</span> __wxConfig <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>global <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>global<span class="token punctuation">.</span>window <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>global<span class="token punctuation">.</span>window<span class="token punctuation">.</span>navigationStyle<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span><span class="token function-variable function">packageType</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>__wxConfig <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>subPackages <span class="token operator">&amp;&amp;</span> __wxConfig<span class="token punctuation">.</span>subPackages<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> __wxConfig<span class="token punctuation">.</span>subPackages<span class="token punctuation">.</span>length<span class="token punctuation">;</span> t<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> n <span class="token operator">=</span> __wxConfig<span class="token punctuation">.</span>subPackages<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">===</span> e<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> n<span class="token punctuation">.</span>independent <span class="token operator">?</span> <span class="token string">&quot;independent&quot;</span><span class="token operator">:</span> <span class="token string">&quot;normal&quot;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token string">&quot;main&quot;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">&quot;none&quot;</span>
    <span class="token punctuation">}</span> <span class="token punctuation">(</span>i<span class="token punctuation">.</span>__route__<span class="token punctuation">)</span><span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>needGetSubjectInfo <span class="token operator">=</span> <span class="token operator">!</span>At<span class="token punctuation">.</span>isInit<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>subPackages <span class="token operator">=</span> __wxConfig<span class="token punctuation">.</span>subPackages<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>perfData <span class="token operator">=</span> <span class="token punctuation">(</span>ie<span class="token punctuation">[</span>ne<span class="token punctuation">]</span> <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ie<span class="token punctuation">[</span><span class="token constant">X</span><span class="token punctuation">]</span> <span class="token operator">=</span> ae <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> ie<span class="token punctuation">[</span>oe<span class="token punctuation">]</span> <span class="token operator">=</span> __wxConfig<span class="token punctuation">.</span>isSubContext <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> ie<span class="token punctuation">[</span><span class="token constant">Q</span><span class="token punctuation">]</span> <span class="token operator">=</span> __wxConfig<span class="token punctuation">.</span>onReadyStart<span class="token punctuation">,</span> ie<span class="token punctuation">[</span>re<span class="token punctuation">]</span> <span class="token operator">=</span> __wxConfig<span class="token punctuation">.</span>onReadyEnd <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">,</span> ae <span class="token operator">=</span> <span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span> ie<span class="token punctuation">)</span><span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>isReload <span class="token operator">=</span> o<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>adInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
        preloadVideoAdUnitIds<span class="token operator">:</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">getPreloadVideoAdUnitIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>permissionBytes <span class="token operator">=</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">getPermissionBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>fontFaceRecords <span class="token operator">=</span> __appServiceSDK__<span class="token punctuation">.</span>fontFaceRecords<span class="token punctuation">,</span>
    a<span class="token punctuation">.</span>fontSizeSetting <span class="token operator">=</span> <span class="token function">Object</span><span class="token punctuation">(</span><span class="token constant">L</span><span class="token punctuation">.</span>getCachedSystemInfo<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fontSizeSetting<span class="token punctuation">;</span>
    <span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token punctuation">{</span>
        ext<span class="token operator">:</span> a<span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
            firstRender<span class="token operator">:</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>
            timestamp<span class="token operator">:</span> n<span class="token punctuation">,</span>
            path<span class="token operator">:</span> i<span class="token punctuation">.</span>__route__
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">,</span>
        u <span class="token operator">=</span> c<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">262144</span> <span class="token operator">&lt;</span> u<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> d <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> d <span class="token operator">&lt;</span> u<span class="token punctuation">;</span><span class="token punctuation">)</span> l<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token number">262144</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            d <span class="token operator">+=</span> <span class="token number">262144</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token operator">++</span>$e<span class="token punctuation">,</span>
            p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
            h <span class="token operator">=</span> l<span class="token punctuation">.</span>length<span class="token punctuation">;</span> p <span class="token operator">&lt;</span> h<span class="token punctuation">;</span> p<span class="token operator">++</span><span class="token punctuation">)</span> qe<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                isSplitData<span class="token operator">:</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>
                splitInfo<span class="token operator">:</span> <span class="token punctuation">{</span>
                    id<span class="token operator">:</span> f<span class="token punctuation">,</span>
                    index<span class="token operator">:</span> p <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    total<span class="token operator">:</span> h<span class="token punctuation">,</span>
                    data<span class="token operator">:</span> l<span class="token punctuation">[</span>p<span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">ze</span><span class="token punctuation">(</span><span class="token string">&quot;pageReady&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">void</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceEndEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    qe<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment">// qe 函数，s 是组装 page 信息的对象</span>
    <span class="token function">ze</span><span class="token punctuation">(</span><span class="token string">&quot;pageReady&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span>
    __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceEndEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br></div></div><p>qe 函数：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">qe</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Object</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>
    <span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">Object</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>
<span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        key<span class="token operator">:</span> <span class="token string">&quot;emit&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            __appServiceSDK__<span class="token punctuation">.</span><span class="token function">invokeWebviewMethod</span><span class="token punctuation">(</span><span class="token string">&quot;appDataChange&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">,</span> <span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    e
<span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>搜索 <code>appDataChange</code>，找不到其他地方定义。我们找到 <code>__appServiceSDK__.invokeWebviewMethod</code> 的定义：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    n<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span>
    n<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">&quot;invokeWebviewMethod&quot;</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> r
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token function">n</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    u <span class="token operator">=</span> <span class="token function">n</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
    d <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token operator">!==</span> t <span class="token operator">?</span> t<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        i <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">?</span> n<span class="token operator">:</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">,</span>
        a <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">?</span> r<span class="token operator">:</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">,</span>
        s <span class="token operator">=</span> l<span class="token operator">++</span><span class="token punctuation">;</span>
        d<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">,</span>
        <span class="token function">Object</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>publish<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;invokeWebviewMethod&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>	<span class="token comment">// 发布</span>
            name<span class="token operator">:</span> e<span class="token punctuation">,</span>
            args<span class="token operator">:</span> o<span class="token punctuation">,</span>
            callbackId<span class="token operator">:</span> s
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">void</span> <span class="token number">0</span> <span class="token operator">===</span> i <span class="token operator">?</span> <span class="token punctuation">[</span>u<span class="token punctuation">.</span>
    <span class="token keyword">default</span><span class="token punctuation">.</span>currentWebviewId<span class="token punctuation">]</span><span class="token operator">:</span>
        i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">Object</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>subscribe<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&quot;callbackWebviewMethod&quot;</span><span class="token punctuation">,</span>	<span class="token comment">// 订阅</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> t <span class="token operator">=</span> e<span class="token punctuation">.</span>res<span class="token punctuation">,</span>
        n <span class="token operator">=</span> e<span class="token punctuation">.</span>callbackId<span class="token punctuation">,</span>
        r <span class="token operator">=</span> d<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">delete</span> d<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">,</span>
        r <span class="token operator">&amp;&amp;</span> <span class="token function">r</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>	<span class="token comment">// 执行</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p>最终发现以下代码会被执行：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>__appServiceSDK__<span class="token punctuation">.</span><span class="token function">onWebviewEvent</span><span class="token punctuation">(</span><span class="token function">_</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceBeginEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Framework&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onWebviewEvent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> t <span class="token operator">=</span> e<span class="token punctuation">.</span>webviewId<span class="token punctuation">,</span>
    n <span class="token operator">=</span> e<span class="token punctuation">.</span>eventName<span class="token punctuation">,</span>
    r <span class="token operator">=</span> e<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
    <span class="token function-variable function">o</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">Ye</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>st<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> o <span class="token operator">=</span> st<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">,</span>
            i <span class="token operator">=</span> o<span class="token punctuation">.</span>page<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">===</span> $<span class="token punctuation">.</span><span class="token constant">DOM_READY_EVENT</span><span class="token punctuation">)</span> <span class="token keyword">return</span> wt<span class="token punctuation">.</span>pageReadyTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">j</span><span class="token punctuation">(</span><span class="token string">&quot;Invoke event onReady in page: &quot;</span> <span class="token operator">+</span> o<span class="token punctuation">.</span>route<span class="token punctuation">)</span><span class="token punctuation">,</span>
            i<span class="token punctuation">.</span><span class="token function">__callPageLifeTime__</span><span class="token punctuation">(</span><span class="token string">&quot;onReady&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>	<span class="token comment">// 3.触发 onReady</span>
            <span class="token keyword">void</span> <span class="token function">vt</span><span class="token punctuation">(</span><span class="token string">&quot;newPage2pageReady&quot;</span><span class="token punctuation">,</span> wt<span class="token punctuation">.</span>newPageTime<span class="token punctuation">,</span> wt<span class="token punctuation">.</span>pageReadyTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>_requireActive<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> a <span class="token operator">=</span> lt<span class="token punctuation">[</span>lt<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>a <span class="token operator">||</span> a<span class="token punctuation">.</span>webviewId <span class="token operator">!==</span> e<span class="token punctuation">)</span> <span class="token keyword">return</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>r<span class="token punctuation">.</span>_relatedInfo <span class="token operator">&amp;&amp;</span> <span class="token constant">F</span><span class="token punctuation">.</span>DisplayReporter<span class="token punctuation">.</span><span class="token function">setEventRelatedInfo</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>_relatedInfo<span class="token punctuation">)</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> s <span class="token operator">=</span> __virtualDOM__<span class="token punctuation">.</span><span class="token function">getNodeById</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>s<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token keyword">var</span> c <span class="token operator">=</span> exparser<span class="token punctuation">.</span>Element<span class="token punctuation">.</span><span class="token function">getMethodCaller</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token function">j</span><span class="token punctuation">(</span><span class="token string">&quot;Invoke event &quot;</span> <span class="token operator">+</span> n <span class="token operator">+</span> <span class="token string">&quot; in component: &quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span>is<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">_t</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">tt</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">void</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token string">&quot;事件警告&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Do not have &quot;</span> <span class="token operator">+</span> n <span class="token operator">+</span> <span class="token string">&quot; handler in component: &quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span>is <span class="token operator">+</span> <span class="token string">&quot;. Please make sure that &quot;</span> <span class="token operator">+</span> n <span class="token operator">+</span> <span class="token string">&quot; handler has been defined in &quot;</span> <span class="token operator">+</span> s<span class="token punctuation">.</span>is <span class="token operator">+</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">j</span><span class="token punctuation">(</span><span class="token string">&quot;Invoke event &quot;</span> <span class="token operator">+</span> n <span class="token operator">+</span> <span class="token string">&quot; in page: &quot;</span> <span class="token operator">+</span> o<span class="token punctuation">.</span>route<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_t</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">tt</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">x</span><span class="token punctuation">(</span><span class="token string">&quot;事件警告&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Do not have &quot;</span> <span class="token operator">+</span> n <span class="token operator">+</span> <span class="token string">&quot; handler in current page: &quot;</span> <span class="token operator">+</span> o<span class="token punctuation">.</span>route <span class="token operator">+</span> <span class="token string">&quot;. Please make sure that &quot;</span> <span class="token operator">+</span> n <span class="token operator">+</span> <span class="token string">&quot; handler has been defined in &quot;</span> <span class="token operator">+</span> o<span class="token punctuation">.</span>route <span class="token operator">+</span> <span class="token string">&quot;, or &quot;</span> <span class="token operator">+</span> o<span class="token punctuation">.</span>route <span class="token operator">+</span> <span class="token string">&quot; has been added into app.json&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token punctuation">(</span>t<span class="token punctuation">,</span> e<span class="token punctuation">.</span>nodeId<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceEndEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    o
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token string">&quot;onWebviewEvent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>说实话，这段代码没太看懂，对着 Page 的 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/page-life-cycle.html" target="_blank" rel="noopener noreferrer">生命周期<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 一起看理解起来会更清晰点，这里还是回到最开始，看传入的 <code>isMainTabBarPage</code>字段做了什么操作。</p> <p>我们回到 jt 函数，发现关键语句：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> u <span class="token operator">=</span> c <span class="token operator">?</span> <span class="token constant">Y</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">:</span> q<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">,</span> s <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>	<span class="token comment">// 初始化 page</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Y：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token constant">K</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;onLoad&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onReady&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onShow&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onRouteEnd&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onHide&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onUnload&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onResize&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token constant">J</span> <span class="token operator">=</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">getLogManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token function-variable function">Y</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">Object</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>
    <span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">Object</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>
<span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        key<span class="token operator">:</span> <span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">d<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> f <span class="token operator">=</span> __virtualDOM__<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
            p <span class="token operator">=</span> exparser<span class="token punctuation">.</span>Element<span class="token punctuation">.</span><span class="token function">getMethodCaller</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span>
            u <span class="token operator">=</span> __virtualDOM__<span class="token punctuation">.</span><span class="token function">getOwnerPluginAppId</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>__wxWebviewId__ <span class="token operator">=</span> d<span class="token punctuation">,</span> p<span class="token punctuation">.</span>__route__ <span class="token operator">=</span> e<span class="token punctuation">,</span> p<span class="token punctuation">.</span>route <span class="token operator">=</span> e<span class="token punctuation">,</span> p<span class="token punctuation">.</span>__displayReporter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">F<span class="token punctuation">.</span>DisplayReporter</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> f<span class="token punctuation">.</span>__customConstructor__ <span class="token operator">===</span> __virtualDOM__<span class="token punctuation">.</span>Page<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> t <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">getRootBehavior</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>methods<span class="token punctuation">,</span>
                n <span class="token operator">=</span> p<span class="token punctuation">.</span>__freeData__<span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> r <span class="token keyword">in</span> t<span class="token punctuation">)</span> p<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> o <span class="token keyword">in</span> n<span class="token punctuation">)</span> p<span class="token punctuation">[</span>o<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">b</span><span class="token punctuation">(</span>n<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">var</span> h <span class="token operator">=</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>deviceOrientation<span class="token punctuation">;</span>
            p<span class="token punctuation">.</span><span class="token function-variable function">__callPageLifeTime__</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token constant">I</span><span class="token punctuation">;</span>
                Reporter<span class="token punctuation">.</span>__route__ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__route__<span class="token punctuation">,</span>
                Reporter<span class="token punctuation">.</span>__method__ <span class="token operator">=</span> e<span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> n<span class="token punctuation">,</span> r<span class="token punctuation">,</span> o<span class="token punctuation">,</span> i<span class="token punctuation">,</span> a<span class="token punctuation">,</span> s <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
                c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;</span> s <span class="token operator">?</span> s <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> u <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> u <span class="token operator">&lt;</span> s<span class="token punctuation">;</span> u<span class="token operator">++</span><span class="token punctuation">)</span> c<span class="token punctuation">[</span>u <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> arguments<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token string">&quot;onLoad&quot;</span> <span class="token operator">===</span> e <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> p<span class="token punctuation">.</span>__displayReporter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setQuery</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">&quot;onShow&quot;</span> <span class="token operator">===</span> e <span class="token operator">?</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>__displayReporter<span class="token punctuation">.</span><span class="token function">reportShowPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Object</span><span class="token punctuation">(</span><span class="token constant">F</span><span class="token punctuation">.</span>checkWebviewAlive<span class="token punctuation">)</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;onReady&quot;</span> <span class="token operator">===</span> e <span class="token operator">?</span> p<span class="token punctuation">.</span>__displayReporter<span class="token punctuation">.</span><span class="token function">setReadyTime</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;onHide&quot;</span> <span class="token operator">===</span> e <span class="token operator">||</span> <span class="token string">&quot;onUnload&quot;</span> <span class="token operator">===</span> e <span class="token operator">?</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__toRoute__<span class="token punctuation">,</span> o <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__isBack__<span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__notReportHide__<span class="token punctuation">,</span> <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__toRoute__<span class="token punctuation">,</span> <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__isBack__<span class="token punctuation">,</span> <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__notReportHide__<span class="token punctuation">,</span> i <span class="token operator">||</span> p<span class="token punctuation">.</span>__displayReporter<span class="token punctuation">.</span><span class="token function">reportHidePage</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Object</span><span class="token punctuation">(</span><span class="token constant">F</span><span class="token punctuation">.</span>stopCheckWebviewAlive<span class="token punctuation">)</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;onResize&quot;</span> <span class="token operator">===</span> e <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>a <span class="token operator">=</span> c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                h <span class="token operator">!==</span> a<span class="token punctuation">.</span>deviceOrientation <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>h <span class="token operator">=</span> a<span class="token punctuation">.</span>deviceOrientation<span class="token punctuation">,</span> p<span class="token punctuation">.</span>__displayReporter<span class="token punctuation">.</span><span class="token function">addOrientationChangeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">&quot;onShow&quot;</span> <span class="token operator">===</span> e <span class="token operator">?</span> f<span class="token punctuation">.</span><span class="token function">triggerPageLifeTime</span><span class="token punctuation">(</span><span class="token string">&quot;show&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;onHide&quot;</span> <span class="token operator">===</span> e <span class="token operator">?</span> f<span class="token punctuation">.</span><span class="token function">triggerPageLifeTime</span><span class="token punctuation">(</span><span class="token string">&quot;hide&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;onResize&quot;</span> <span class="token operator">===</span> e <span class="token operator">&amp;&amp;</span> f<span class="token punctuation">.</span><span class="token function">triggerPageLifeTime</span><span class="token punctuation">(</span><span class="token string">&quot;resize&quot;</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">j</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>__route__ <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> e <span class="token operator">+</span> <span class="token string">&quot; have been invoked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceBeginEvent</span><span class="token punctuation">(</span><span class="token string">&quot;LifeCycle&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Page.&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">var</span> l <span class="token operator">=</span> <span class="token function">t</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceEndEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Reporter<span class="token punctuation">.</span>__route__ <span class="token operator">=</span> Reporter<span class="token punctuation">.</span>__method__ <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                l
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token constant">K</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> c <span class="token operator">=</span> p<span class="token punctuation">[</span>s<span class="token punctuation">]</span><span class="token punctuation">;</span>
                p<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">var</span> e<span class="token punctuation">,</span> t <span class="token operator">=</span> c <span class="token operator">||</span> <span class="token constant">I</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> n <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">,</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> r<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> o<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        e <span class="token operator">=</span> <span class="token function">t</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">var</span> a <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> n<span class="token punctuation">;</span>
                        <span class="token number">1e3</span> <span class="token operator">&lt;</span> a <span class="token operator">&amp;&amp;</span> Reporter<span class="token punctuation">.</span><span class="token function">slowReport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            key<span class="token operator">:</span> <span class="token string">&quot;pageInvoke&quot;</span><span class="token punctuation">,</span>
                            cost<span class="token operator">:</span> a<span class="token punctuation">,</span>
                            extend<span class="token operator">:</span> <span class="token string">'at &quot;'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__route__ <span class="token operator">+</span> <span class="token string">'&quot; page lifeCycleMethod '</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot; function&quot;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token constant">J</span> <span class="token operator">&amp;&amp;</span> <span class="token constant">J</span><span class="token punctuation">.</span>logApiInvoke <span class="token operator">&amp;&amp;</span> <span class="token constant">J</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;page &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__route__ <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot; have been invoked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        __appServiceSDK__<span class="token punctuation">.</span>nativeConsole<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;component page &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__route__ <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot; have been invoked&quot;</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        Reporter<span class="token punctuation">.</span><span class="token function">thirdErrorReport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            source<span class="token operator">:</span> u<span class="token punctuation">,</span>
                            error<span class="token operator">:</span> e<span class="token punctuation">,</span>
                            extend<span class="token operator">:</span> <span class="token string">'at &quot;'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__route__ <span class="token operator">+</span> <span class="token string">'&quot; page lifeCycleMethod '</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot; function&quot;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">return</span> e
                <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> p<span class="token punctuation">.</span>onShareAppMessage<span class="token punctuation">;</span>
            i <span class="token operator">&amp;&amp;</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">showShareMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> p<span class="token punctuation">.</span>onShareTimeline<span class="token punctuation">;</span>
            <span class="token keyword">return</span> i <span class="token operator">&amp;&amp;</span> a <span class="token operator">&amp;&amp;</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">showShareTimelineMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                page<span class="token operator">:</span> p<span class="token punctuation">,</span>
                node<span class="token operator">:</span> f
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        key<span class="token operator">:</span> <span class="token string">&quot;destroy&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            __virtualDOM__<span class="token punctuation">.</span><span class="token function">removeView</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>__wxWebviewId__<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    e
<span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br></div></div><p>q:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token constant">B</span> <span class="token operator">=</span> Object<span class="token punctuation">.</span>assign<span class="token punctuation">,</span>
<span class="token constant">L</span> <span class="token operator">=</span> <span class="token function">n</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token constant">F</span> <span class="token operator">=</span> <span class="token function">n</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token constant">W</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;onLoad&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onReady&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onShow&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onRouteEnd&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onHide&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onUnload&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;onResize&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token function-variable function">U</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> <span class="token constant">W</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>t<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">W</span><span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">===</span> e<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">!</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token string">&quot;data&quot;</span> <span class="token operator">===</span> e
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token constant">V</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;__wxWebviewId__&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;__route__&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token constant">G</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;route&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token function-variable function">z</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">!==</span> <span class="token constant">V</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token constant">H</span> <span class="token operator">=</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">getLogManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token function-variable function">q</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
        c <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token keyword">void</span> <span class="token number">0</span> <span class="token operator">!==</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">?</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        d <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">?</span> arguments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">,</span>
        e <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">?</span> arguments<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">void</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">Object</span><span class="token punctuation">(</span>g<span class="token punctuation">.</span>
    <span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token punctuation">{</span>
            __wxWebviewId__<span class="token operator">:</span> d<span class="token punctuation">,</span>
            __route__<span class="token operator">:</span> e
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token constant">V</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> e<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">x</span><span class="token punctuation">(</span><span class="token string">&quot;关键字保护&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;should not change the protected attribute &quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> n<span class="token punctuation">[</span>e<span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> r <span class="token operator">=</span> __virtualDOM__<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
        o <span class="token operator">=</span> exparser<span class="token punctuation">.</span>Element<span class="token punctuation">.</span><span class="token function">getMethodCaller</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span>
        u <span class="token operator">=</span> __virtualDOM__<span class="token punctuation">.</span><span class="token function">getOwnerPluginAppId</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>__wxExparserNode__ <span class="token operator">=</span> r<span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>__wxComponentInst__ <span class="token operator">=</span> o<span class="token punctuation">,</span>
        exparser<span class="token punctuation">.</span>Element<span class="token punctuation">.</span><span class="token function">setMethodCaller</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        c<span class="token punctuation">.</span>data <span class="token operator">=</span> c<span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token constant">T</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token string">&quot;Page data error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Page.data must be an object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>__viewData__ <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>__displayReporter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">F<span class="token punctuation">.</span>DisplayReporter</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> f <span class="token operator">=</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>deviceOrientation<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">__callPageLifeTime__</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token constant">I</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            Reporter<span class="token punctuation">.</span>__route__ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__route__<span class="token punctuation">,</span>
            Reporter<span class="token punctuation">.</span>__method__ <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> n<span class="token punctuation">,</span> r<span class="token punctuation">,</span> o<span class="token punctuation">,</span> i<span class="token punctuation">,</span> a<span class="token punctuation">,</span> s <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
            c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;</span> s <span class="token operator">?</span> s <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> u <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> u <span class="token operator">&lt;</span> s<span class="token punctuation">;</span> u<span class="token operator">++</span><span class="token punctuation">)</span> c<span class="token punctuation">[</span>u <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> arguments<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token string">&quot;onLoad&quot;</span> <span class="token operator">===</span> e <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__displayReporter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setQuery</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">&quot;onShow&quot;</span> <span class="token operator">===</span> e <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>__displayReporter<span class="token punctuation">.</span><span class="token function">reportShowPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Object</span><span class="token punctuation">(</span><span class="token constant">F</span><span class="token punctuation">.</span>checkWebviewAlive<span class="token punctuation">)</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;onReady&quot;</span> <span class="token operator">===</span> e <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__displayReporter<span class="token punctuation">.</span><span class="token function">setReadyTime</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;onHide&quot;</span> <span class="token operator">===</span> e <span class="token operator">||</span> <span class="token string">&quot;onUnload&quot;</span> <span class="token operator">===</span> e <span class="token operator">?</span> <span class="token punctuation">(</span>r <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__toRoute__<span class="token punctuation">,</span> o <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__isBack__<span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__notReportHide__<span class="token punctuation">,</span> <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__toRoute__<span class="token punctuation">,</span> <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__isBack__<span class="token punctuation">,</span> <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__notReportHide__<span class="token punctuation">,</span> i <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__displayReporter<span class="token punctuation">.</span><span class="token function">reportHidePage</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">Object</span><span class="token punctuation">(</span><span class="token constant">F</span><span class="token punctuation">.</span>stopCheckWebviewAlive<span class="token punctuation">)</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;onResize&quot;</span> <span class="token operator">===</span> e <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>a <span class="token operator">=</span> c<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            f <span class="token operator">!==</span> a<span class="token punctuation">.</span>deviceOrientation <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>f <span class="token operator">=</span> a<span class="token punctuation">.</span>deviceOrientation<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__displayReporter<span class="token punctuation">.</span><span class="token function">addOrientationChangeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">j</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>__route__ <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> e <span class="token operator">+</span> <span class="token string">&quot; have been invoked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceBeginEvent</span><span class="token punctuation">(</span><span class="token string">&quot;LifeCycle&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Page.&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> l <span class="token operator">=</span> <span class="token function">t</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceEndEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            Reporter<span class="token punctuation">.</span>__route__ <span class="token operator">=</span> Reporter<span class="token punctuation">.</span>__method__ <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            l
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token constant">W</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            t<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> e<span class="token punctuation">,</span> t <span class="token operator">=</span> <span class="token punctuation">(</span>c<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token constant">I</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> n <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">,</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> r<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> o<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    e <span class="token operator">=</span> <span class="token function">t</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">var</span> a <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> n<span class="token punctuation">;</span>
                    <span class="token number">1e3</span> <span class="token operator">&lt;</span> a <span class="token operator">&amp;&amp;</span> Reporter<span class="token punctuation">.</span><span class="token function">slowReport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        key<span class="token operator">:</span> <span class="token string">&quot;pageInvoke&quot;</span><span class="token punctuation">,</span>
                        cost<span class="token operator">:</span> a<span class="token punctuation">,</span>
                        extend<span class="token operator">:</span> <span class="token string">&quot;at &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__route__ <span class="token operator">+</span> <span class="token string">&quot; page lifeCycleMethod &quot;</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot; function&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token constant">H</span> <span class="token operator">&amp;&amp;</span> <span class="token constant">H</span><span class="token punctuation">.</span>logApiInvoke <span class="token operator">&amp;&amp;</span> <span class="token constant">H</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;page &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__route__ <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot; have been invoked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    __appServiceSDK__<span class="token punctuation">.</span>nativeConsole<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;page &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__route__ <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot; have been invoked&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    Reporter<span class="token punctuation">.</span><span class="token function">thirdErrorReport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        source<span class="token operator">:</span> u<span class="token punctuation">,</span>
                        error<span class="token operator">:</span> e<span class="token punctuation">,</span>
                        extend<span class="token operator">:</span> <span class="token string">&quot;at &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__route__ <span class="token operator">+</span> <span class="token string">&quot; page lifeCycleMethod &quot;</span> <span class="token operator">+</span> s <span class="token operator">+</span> <span class="token string">&quot; function&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> e
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> a <span class="token keyword">in</span> c<span class="token punctuation">)</span> <span class="token operator">!</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">z</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">x</span><span class="token punctuation">(</span><span class="token string">&quot;关键字保护&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Page's &quot;</span> <span class="token operator">+</span> a <span class="token operator">+</span> <span class="token string">&quot; is write-protected&quot;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token constant">U</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token string">&quot;Function&quot;</span> <span class="token operator">===</span> <span class="token function">k</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> t<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> e<span class="token punctuation">;</span>
                Reporter<span class="token punctuation">.</span>__route__ <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__route__<span class="token punctuation">,</span>
                Reporter<span class="token punctuation">.</span>__method__ <span class="token operator">=</span> a<span class="token punctuation">,</span>
                __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceBeginEvent</span><span class="token punctuation">(</span><span class="token string">&quot;User Script&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Page.&quot;</span> <span class="token operator">+</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> t <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">,</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> o <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> o <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> o<span class="token operator">++</span><span class="token punctuation">)</span> r<span class="token punctuation">[</span>o<span class="token punctuation">]</span> <span class="token operator">=</span> arguments<span class="token punctuation">[</span>o<span class="token punctuation">]</span><span class="token punctuation">;</span>
                    e <span class="token operator">=</span> c<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">var</span> i <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t<span class="token punctuation">;</span>
                    <span class="token number">1e3</span> <span class="token operator">&lt;</span> i <span class="token operator">&amp;&amp;</span> Reporter<span class="token punctuation">.</span><span class="token function">slowReport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        key<span class="token operator">:</span> <span class="token string">&quot;pageInvoke&quot;</span><span class="token punctuation">,</span>
                        cost<span class="token operator">:</span> i<span class="token punctuation">,</span>
                        extend<span class="token operator">:</span> <span class="token string">&quot;at &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__route__ <span class="token operator">+</span> <span class="token string">&quot; page &quot;</span> <span class="token operator">+</span> a <span class="token operator">+</span> <span class="token string">&quot; function&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    Reporter<span class="token punctuation">.</span><span class="token function">thirdErrorReport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        source<span class="token operator">:</span> u<span class="token punctuation">,</span>
                        error<span class="token operator">:</span> e<span class="token punctuation">,</span>
                        extend<span class="token operator">:</span> <span class="token string">&quot;at &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__route__ <span class="token operator">+</span> <span class="token string">&quot; page &quot;</span> <span class="token operator">+</span> a <span class="token operator">+</span> <span class="token string">&quot; function&quot;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceEndEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                Reporter<span class="token punctuation">.</span>__route__ <span class="token operator">=</span> Reporter<span class="token punctuation">.</span>__method__ <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                e
            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token operator">:</span> t<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">b</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token punctuation">{</span>
            route<span class="token operator">:</span> e
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token constant">G</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> e<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>t<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">=</span> s<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> l <span class="token operator">=</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> c<span class="token punctuation">.</span>onShareAppMessage<span class="token punctuation">;</span>
        l <span class="token operator">&amp;&amp;</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">showShareMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">==</span> <span class="token keyword">typeof</span> c<span class="token punctuation">.</span>onShareTimeline<span class="token punctuation">;</span>
        l <span class="token operator">&amp;&amp;</span> p <span class="token operator">&amp;&amp;</span> __appServiceSDK__<span class="token punctuation">.</span><span class="token function">showShareTimelineMenu</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">Object</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>
<span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        key<span class="token operator">:</span> <span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> t<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">h</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">,</span>
            o <span class="token operator">=</span> r<span class="token punctuation">.</span>__wxExparserNode__<span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">delete</span> r<span class="token punctuation">.</span>__wxExparserNode__<span class="token punctuation">,</span>
            <span class="token punctuation">{</span>
                page<span class="token operator">:</span> r<span class="token punctuation">,</span>
                node<span class="token operator">:</span> o
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        key<span class="token operator">:</span> <span class="token string">&quot;destroy&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            __virtualDOM__<span class="token punctuation">.</span><span class="token function">removeView</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>__wxWebviewId__<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">Object</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>
<span class="token keyword">default</span><span class="token punctuation">)</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        key<span class="token operator">:</span> <span class="token string">&quot;setData&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">c<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> u <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">var</span> t <span class="token operator">=</span> <span class="token function">k</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;Object&quot;</span> <span class="token operator">!==</span> t<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">void</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token string">&quot;类型错误&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;setData accepts an Object rather than some &quot;</span> <span class="token operator">+</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">void</span> <span class="token number">0</span> <span class="token operator">===</span> c<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token constant">A</span><span class="token punctuation">(</span><span class="token string">&quot;Page setData warning&quot;</span><span class="token punctuation">,</span> <span class="token string">'Setting data field &quot;'</span> <span class="token operator">+</span> e <span class="token operator">+</span> <span class="token string">'&quot; to undefined is invalid.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">var</span> t<span class="token punctuation">,</span> n<span class="token punctuation">,</span> r<span class="token punctuation">,</span> o <span class="token operator">=</span> <span class="token constant">M</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    i <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>data<span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    a <span class="token operator">=</span> i<span class="token punctuation">.</span>obj<span class="token punctuation">,</span>
                    s <span class="token operator">=</span> i<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
                    a <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>s<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">b</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token keyword">void</span> <span class="token number">0</span> <span class="token operator">!==</span> c<span class="token punctuation">[</span>e<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>n <span class="token operator">=</span> <span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token constant">R</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>__viewData__<span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>obj<span class="token punctuation">,</span> r <span class="token operator">=</span> t<span class="token punctuation">.</span>key<span class="token punctuation">,</span> n <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>n<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">b</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceBeginEvent</span><span class="token punctuation">(</span><span class="token string">&quot;Framework&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DataEmitter::emit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>__wxComponentInst__<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">,</span>
                __appServiceSDK__<span class="token punctuation">.</span><span class="token function">traceEndEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">v</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        key<span class="token operator">:</span> <span class="token string">&quot;pageScrollTo&quot;</span><span class="token punctuation">,</span>
        <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            __appServiceSDK__<span class="token punctuation">.</span><span class="token function">publishPageScrollTo</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>__wxWebviewId__<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    h
<span class="token punctuation">}</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br></div></div><p>仍然没有发现 <code>isMainTabBarPage</code>关键字。</p> <p>以上，第五步虽然没找到我们想找到的逻辑，但是发现其实 jt 函数其实和其他路由函数执行的是同一段逻辑，不影响我们对 <code>wx.reLaunch</code>执行过程的分析。</p> <h3 id="结论"><a href="#结论" class="header-anchor">#</a> 结论</h3> <p>最终，结合源码，我们得出<code>wx.reLaunch</code>的最终执行过程如下图所示：</p> <p><img src="http://qbk4nzztg.bkt.clouddn.com//image-20200607202125712.png" alt="image-20200607202125712"></p> <p>关于 <code>wx.reLaunch</code>的执行过程，额外提出几个点需要注意：</p> <ol><li><code>wx.reLaunch</code>真正的逻辑是清空路由，再打开新页面，并不是传统意义上的“重启”；</li> <li><code>wx.reLaunch</code>只会影响小程序各生命周期（回调）的执行，全局 js 代码在小程序加载时执行，分包中的全局 js 代码在分包加载时执行；</li> <li><code>wx.reLaunch</code>的目标页在分包内，且分包未加载过时，会先加载分包代码，再执行后续逻辑（unUnload + openNewPage）；</li> <li><code>wx.reLaunch</code>在非 iOS 设备中，如果小程序不在前台时，执行会报错，导致无法跳转。</li></ol> <hr> <p>除此之外，再额外说几个在 debug 过程中的总结的小 tips：</p> <p>1、如果在代码里不太好看一些变量或表达式的值，可以复制下来贴在 watch 里。</p> <p>2、发现一些 function 执行了，但是不知道函数定义的位置位置，可以先将其放进 watch 里，等其有值的时候点开会有一个路径点击开就到了函数定义的位置了。</p> <p>3、不要无脑 debug，带着疑问，先在脑子里假设出你推测或者认为的一些结论，用 debug 去验证，否则中间很难发现关键信息。其实本文的成因并非是我真的想去深入了解下 <code>wx.reLaunch</code>的执行过程，而是因为对他的理解有偏差，在排查线上 bug 时产生了一些自己无法理解的现象。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.39cd9fe8.js" defer></script><script src="/assets/js/2.262fd2a8.js" defer></script><script src="/assets/js/6.cf0fea36.js" defer></script>
  </body>
</html>
